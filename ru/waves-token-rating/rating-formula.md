# Формула расчета рейтинга

Рейтинг токена есть суточное средневзвешенное значение отдельных оценок всех пользователей, когда либо оценивавших этот токен:

R = (R<sub>1</sub>W<sub>1</sub> + R<sub>2</sub>W<sub>2</sub> + ... + R<sub>n</sub>W<sub>n</sub>) / (W<sub>1</sub> + W<sub>2</sub> + ... + W<sub>n</sub>),

где

R<sub>n</sub> — оценка n-го пользователя,

W<sub>n</sub> — вес оценки n-го пользователя.

Полученное значение `R` округляется до десятых долей числа.

## Оценка пользователя R<sub>n</sub>

Пользователь выставляет оценку токену R<sub>n</sub> внутри карточки токена при помощи звездочек и кнопки **Оценить**. R<sub>n</sub> принимает целые значения от 1 до 5 включительно.

Пользователь может оценивать один и тот же токен много раз — в расчет будет браться самая последняя оценка.

Пользователь может оценить любой токен из браузера, в котором установлен [Waves Keeper](/waves-keeper/about-waves-keeper.md), если на балансе его аккаунта не меньше 1 [WCT](/blockchain/token/wct.md). Токены WCT при оценке не списываются, но их количество влияет на W<sub>n</sub>.

## Вес оценки пользователя W<sub>n</sub>

Величина W<sub>n</sub> рассчитывается по формуле:

W<sub>n</sub> = B<sub>n</sub>k<sub>n</sub>,

где

B<sub>n</sub> — эффективный баланс n-го пользователя в токенах WCT,

k<sub>n</sub> — весовой коэффициент n-го пользователя.

Полученное значение W<sub>n</sub> округляется до целого числа.

## Эффективный баланс пользователя B<sub>n</sub>

Эффективный баланс B<sub>n</sub> — это баланс токенов WCT на момент выставления оценки, минус сумма всех расходных операций в WCT в течение следующих 24 часов.

Если B<sub>n</sub> < 1, то оценка не будет учитываться при расчете рейтинга токена.

## Весовой коэффициент пользователя k<sub>n</sub>

Величина коэффициента k<sub>n</sub> зависит от величины эффективного баланса B<sub>n</sub> оценивающего и рассчитывается по формуле:

|Величина эффективного баланса B<sub>n</sub> оценивающего|Значение весового коэффициента k<sub>n</sub>|
| --- | --- |
| [1 — 100] | 1 |
| (100 — 35,000] | – 0.086 × ln(B<sub>n</sub> × 2 ) + 1.66|
| (35,000 - 150,000] | – 0.0705 × ln(B<sub>n</sub>) + 1.34 |
| (150,000 — 420,000] | – 0,00019 × B<sub>n</sub> + 162.77 |
| (420,000 - 580,000] | – 0,00011 × B<sub>n</sub> + 128.56 |
| (580,000 — ∞) | 0,0621 |

Полученное значение k<sub>n</sub> округляется до сотых долей числа.

## Пример расчета рейтинга токена

**Пользователь 1** оценил токен в 5 звезд. На момент голосования на его балансе было 10 000 WCT.

За 24 часа было 3 операции: расход 300 WTC, расход 200 WTC и доход 500 WTC. Получается, расходные операции составляют 300 + 200 = 500 WTC. Таким образом 9 500 WCT — это эффективный баланс B<sub>1</sub> (несмотря на то что на балансе через 24 часа остались те же 10 000 WCT, что и на момент выставления оценки).

B<sub>1</sub> находится в диапазоне 100 - 35,000, значит рассчитываем k<sub>1</sub> по формуле:

k<sub>1</sub> = -0.086 × ln(9,500 × 2) + 1.66 = -0.086 × 14.2137118 + 1.66 = 0.43762

Вес оценки:

W<sub>1</sub> = B<sub>1</sub> × k<sub>1</sub> = 9,500 × 0.43762 = 4,157

Итого: токен получил от пользователя 1 оценку 5 с весом 4,157.

**Пользователь 2** оценил тот же токен в 4 звезды. На момент голосования на его балансе было 7 WCT.

За 24 часа расходных операций не было, значит эффективный баланс B<sub>2</sub> равен 70 WCT.

B<sub>2</sub> находится в промежутке 1 — 100, в этом случае:

k<sub>2</sub> = 1

Вес оценки:

W<sub>2</sub> = B<sub>2</sub> × k<sub>2</sub> = 70 × 1 = 70

Итого: токен получил от пользователя 2 оценку 4 с весом 70.

Рейтинг `R` токена будет рассчитываться как средневзвешенное значение оценок, выставленных обоими пользователями:

R = (5 × 4,157 + 4 × 70) / (4,157 + 70) = 4,983 (округляется до 5,0)

Количество WCT, выставивших оценку 5 будет 4,157, оценку 4 — 70, а общий вес WCT — 4227:

<img src="img/rating.png" alt="faucet" width="550"/>
